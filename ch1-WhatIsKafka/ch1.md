
# 카프카란 무엇인가?

<hr>

### 카프카
* 대용량, 대규모 메시지 데이터를 빠르게 처리하도록 개발된 메시징 플랫폼
* `end-to-end` 아키텍처의 문제점
  * 트랜젝션 처리와 비동기 처리가 동시에 이뤄지지만 통합된 전송 영역이 없어 복잡도가 증가
  * 데이터 파이프라인 관리가 어려움
* 카프카의 특징
  * 프로듀서와 컨슈머의 분리
  * 메시징 시스템과 같이 영구 메시지 데이터를 여러 컨슈머에게 허용(멀티 프로듀서 - 멀티 컨슈머 구조)
  * 일정 주기동안 메시지를 디스크에 저장
  * 컨슈머 그룹이 다르면 여러 컨슈머들이 같은 토픽의 메시지를 구독할 수 있음(MQ와의 차이)
  * 스케일 아웃이 가능한 시스템 -> 확장성이 좋음
  * 높은 처리량을 위한 메시지 최적화 -> 높은 성능
* 카프카 이용 방식
  * 카프라가 전 부문에 데이터 파이프라인으로 동작하기 때문에 모든 데이터 스토어와 이벤트를 카프카를 중심으로 연결
  * 애플리케이션은 카프카에만 데이터를 전달하고 필요한 곳에서 가져감
  * 코디네이션 애플리케이션인 `주키퍼` 클러스터를 홀수개-과반수 이상의 클러스터 구조를 유지하여 카프카 클러스터에 연동하여 운영하면서 카프카를 관리함
  * 주키퍼에 장애가 있으면 카프카도 장애 상황에 놓임

### 주키퍼
* 카프카의 상태관리를 위한 코디네이션 애플리케이션
* 주키퍼의 역할
  * 설정 관리(Configuration management): 클러스터의 설정 정보를 최신으로 유지하기 위한 조율 시스템으로 사용
  * 클러스터 관리(Cluster management): 클러스터의 서버가 추가되거나 제외될 때 그 정보를 클러스터 안 서버들이 공유하는 데 사용
  * `리더 채택(Leader selection)`: 다중 어플리케이션 중에서 어떤 노드를 리더로 선출할 지를 정하는 로직을 만드는 데 사용
  * 락, 동기화 서비스(Locking and synchronization service): 클러스터 전체를 대상을 동기화해 경쟁상태에 들어갈 경우를 사전에 방지


### 카프카 동작 방식과 원리
* 동작 방식
  * 카프카는 기본적으로 메시징 서버로 동작
  * 메시지라고 불리는 데이터 단위를 퍼블리셔(프로듀서)에서 카프카에 토픽이라는 큐 형태의 저장소에 저장하면 서브스크라이버(컨슈머)가 토픽에서 데이터를 가져가는 구조
  * 발신자는 수신자가 정해져 있지 않는 상태로 발행하고 구독자는 카프카에 신청을 하고 메시지를 구독
* 장점
  * 비동기적 메시징 시스템만 살아 있으면 프로듀서에게 전달된 메시지는 유실되지 않음
  * 카프카를 중심으로 연결되어 있기 때문에 확장성이 용이
  * 메시징 시스템의 작업량을 프로듀서와 컨슈머로 분산하여 메시징 시스템보다 부하가 적음
  * 구조가 매우 단순하고 시스템에 문제가 발생하더라도 연쇄작용이 발생하지 않음
* 용어 정리
  * `카프카`: 클러스터 구성이 가능한 데이터 플랫폼
  * `브로커`: 카프카 애플리케이션이 설치된 서버(노드)
  * `토픽`: 카프카로 보낸 메시지를 구분하기 위한 네임
  * `파티션`: 토픽을 구성하는 저장소로 많은 양의 메시지를 병렬 처리하기 위해 `토픽을 나누는 개념`
  * `리플리케이션`: 장애 상황에 대응하기 위해 만든 복제 기능으로 토픽 단위의 리플리케이션이 아닌 파티션 단위의 리플리케이션
  * `리더`: 복제본 중에서 하나가 리더가 선출되고 이 리더가 모든 읽기, 쓰기 연산을 담당
  * `팔로워`:리더를 제외한 나머지 복제본은 팔로워가 되고 이 팔로워들은 단순히 리더의 데이터를 복사하는 역할
  * `프로듀서`: 카프카로 자신들의 메시지를 토픽이라는 이름으로 발행하는 서버(애플리케이션)
  * `컨슈머`: 토픽 이름으로 저장된 메시지를 가져가는 서버(애플리케이션)
  * `주키퍼`: 컨슈머와 카프카와 통신하여 카프카의 메타데이터 정보를 `지노드`에 Key-Value 형태로 저장하는 상태관리 코디네이션 애플리케이션
  * `앙상블`: 주키퍼 클러스터
